# 用户需求清单

## 一、通用流程
1. 文件处理
   * 支持用户上传语音文件或图片文件
   * 后台接收文件后进行文字提取

2. 实时通信
   * 使用 WebSocket 进行前后端实时通信
   * 消息包含基本要素：
     - 对话ID（标识一次完整业务流程）
     - 消息ID（对话内递增，标识消息顺序）
     - 消息内容（文本内容和结构化数据）
   * 某个对话内的消息顺序严格按照消息ID递增

## 二、引导场景分支（SceneModule）
1. 初始引导
   * 用户首次进入系统时提供语音引导
   * 支持用户通过语音表达意图（如"我想做订单智能录入"）
   * 系统识别用户意图并提供相应引导

2. 场景导航
   * 识别用户场景切换请求（如"我想去报表页面"）
   * 根据用户意图进行页面跳转
   * 保持用户对话状态

## 三、订单处理分支
1. 信息提取
   * 从文字中解析订单相关信息
   * 提取公司名称信息
   * 提取发货和收货地址信息

2. 信息确认
   * 后台推送解析出的结构化订单信息至前端
   * 系统提供候选的公司名称和地址供用户选择
   * 用户确认或修正信息

3. 订单创建
   * 用户确认信息后创建订单
   * 返回订单创建结果

## 四、报表处理分支
1. 明确信息场景
   * 系统识别出明确的报表请求
   * 生成标准化报表数据
   * 通过 WebSocket 返回数据供前端渲染

2. 需要确认场景
   * 系统识别出模糊的报表请求
   * 通过 WebSocket 向用户提出澄清问题
   * 接收用户补充信息
   * 生成并返回报表数据

3. 报表生成与结果追踪
   * SQL 生成与关联
     - 系统根据语音描述生成对应的 SQL 语句
     - 为每次生成的 SQL 分配唯一标识
     - 在对话中保存 SQL 标识与执行结果的关联关系
     - 记录 SQL 生成的时间戳和上下文信息

   * 报表结果处理
     - 执行 SQL 生成报表数据
     - 为每个报表结果生成唯一标识
     - 在对话中保存报表结果与对应 SQL 的关联关系
     - 记录报表生成时间和结果摘要

4. 报表收藏功能
   * 收藏流程
     - 用户对满意的报表结果进行收藏
     - 系统通过对话上下文定位到具体的 SQL 和报表结果
     - 系统根据报表内容自动生成推荐名称
     - 用户可使用推荐名称或自定义名称

   * 收藏信息记录
     - 收藏的 SQL 语句
     - 报表名称（推荐名称或用户自定义）
     - 收藏时间
     - 最后执行时间
     - 报表描述和关键参数

   * 报表收藏管理
     - 提供报表收藏清单
     - 显示报表名称和最后执行时间
     - 支持报表重命名
     - 支持报表删除
     - 记录报表使用频率

   * 收藏报表使用
     - 从收藏清单中选择报表直接预览
     - 使用保存的 SQL 重新生成报表数据
     - 支持修改报表参数（如时间范围）
     - 记录报表查看历史

## 五、对话管理
1. 对话信息记录
   * 对话基本信息
     - 对话ID
     - 对话场景管理（订单/报表）
     - 创建时间
     - 对话状态
     - 创建者信息

2. 消息记录
   * 消息基本信息
     - 消息ID（序号）
     - 所属对话ID
     - 发送方信息
     - 接收方信息
     - 消息内容
     - 创建时间
   * 多媒体信息
     - 语音文件地址（如有）
     - 图片文件地址（如有）

3. 对话管理功能
   * 对话创建与恢复
     - 用户进入订单或者报表功能页面时默认建立新的对话
     - 支持根据对话ID恢复历史对话
     - 对话超时自动结束（5分钟无消息）

   * 消息存储
     - 实时保存所有消息记录
     - 保存多媒体文件访问地址

   * 历史查询
     - 支持查询历史对话
     - 支持查看对话内的消息记录
     - 支持查看关联的多媒体文件

   * 对话删除
     - 支持删除历史对话
     - 删除对话时清除该对话的所有相关数据
     - 删除操作不可恢复