# 产品需求文档(PRD)

## 1. 产品概述

### 1.1 产品定位
本系统是一个智能化的订单处理和报表分析平台，通过语音交互和自然语言处理技术，为用户提供便捷的订单录入和数据分析体验。

### 1.2 目标用户
- 需要进行订单录入的业务人员
- 需要查看和分析业务数据的管理人员

### 1.3 核心价值
- 提供语音交互的智能订单录入功能
- 支持自然语言生成报表的数据分析能力
- 实现便捷的报表收藏和复用机制

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 通用功能模块
1. 文件处理功能
   - 支持语音文件上传
   - 支持图片文件上传
   - 文件内容文字提取
   
2. WebSocket实时通信
   - 消息格式规范：
     ```json
     {
       "dialogId": "string",    // 对话ID
       "messageId": "number",   // 消息ID
       "content": {             // 消息内容
         "text": "string",      // 文本内容
         "structured": {}       // 结构化数据
       }
     }
     ```
   - 消息顺序性保证：同一对话内消息按ID严格递增

#### 2.1.2 场景引导模块
1. 初始引导功能
   - 首次进入系统提供语音引导
   - 支持语音意图识别
   - 基于意图进行场景推荐

2. 场景导航功能
   - 支持场景切换请求识别
   - 保持用户对话状态
   - 实现无缝场景跳转

#### 2.1.3 订单处理模块
1. 信息提取功能
   - 订单信息解析：
     - 公司名称识别
     - 发货地址解析
     - 收货地址解析
   
2. 信息确认功能
   - 结构化信息展示
   - 候选信息选择
   - 信息修正确认

3. 订单创建功能
   - 订单数据持久化
   - 创建结果反馈

#### 2.1.4 报表处理模块
1. 报表生成功能
   - 明确场景处理：
     - 标准报表生成
     - 数据实时返回
   
   - 需确认场景处理：
     - 澄清问题交互
     - 补充信息收集
     - 报表动态生成

2. SQL追踪功能
   - SQL生成记录：
     ```json
     {
       "sqlId": "string",          // SQL唯一标识
       "sql": "string",            // SQL语句
       "dialogId": "string",       // 关联对话ID
       "messageId": "number",      // 关联消息ID
       "timestamp": "datetime",    // 生成时间
       "context": {}               // 上下文信息
     }
     ```
   
   - 结果关联记录：
     ```json
     {
       "resultId": "string",       // 结果唯一标识
       "sqlId": "string",          // 关联SQL ID
       "data": {},                 // 报表数据
       "timestamp": "datetime",    // 生成时间
       "summary": "string"         // 结果摘要
     }
     ```

3. 报表收藏功能
   - 收藏信息结构：
     ```json
     {
       "favoriteId": "string",     // 收藏唯一标识
       "name": "string",           // 报表名称
       "sql": "string",            // SQL语句
       "description": "string",    // 报表描述
       "parameters": {},           // 关键参数
       "createTime": "datetime",   // 收藏时间
       "lastExecuteTime": "datetime", // 最后执行时间
       "frequency": "number"       // 使用频率
     }
     ```
   
   - 收藏管理功能：
     - 收藏列表查看
     - 报表重命名
     - 报表删除
     - 使用频率统计

#### 2.1.5 对话管理模块
1. 对话信息结构
   ```json
   {
     "dialogId": "string",         // 对话ID
     "scene": "string",            // 场景(order/report)
     "status": "string",           // 对话状态
     "creator": "string",          // 创建者
     "createTime": "datetime"      // 创建时间
   }
   ```

2. 消息信息结构
   ```json
   {
     "messageId": "number",        // 消息ID
     "dialogId": "string",         // 对话ID
     "sender": "string",           // 发送方
     "receiver": "string",         // 接收方
     "content": {},                // 消息内容
     "createTime": "datetime",     // 创建时间
     "mediaUrls": {                // 多媒体信息
       "voice": "string",          // 语音文件地址
       "image": "string"           // 图片文件地址
     }
   }
   ```

3. 对话管理功能
   - 对话生命周期：
     - 新建对话：进入功能页面时创建
     - 恢复对话：根据对话ID恢复
     - 结束对话：5分钟无消息自动结束
   
   - 历史管理功能：
     - 历史对话查询
     - 消息记录查看
     - 多媒体文件访问
     - 对话删除处理

## 3. 非功能需求

### 3.1 性能需求
- 语音识别响应时间 < 2秒
- WebSocket消息延迟 < 100ms
- 报表数据生成时间 < 5秒
- 系统支持并发用户数 > 100

### 3.2 安全需求
- 用户身份认证
- 数据传输加密
- 文件上传安全检查
- 敏感信息脱敏处理

### 3.3 可用性需求
- 系统可用性 > 99.9%
- 支持故障自动恢复
- 提供完整的错误提示
- 保证数据一致性

### 3.4 兼容性需求
- 支持主流浏览器
- 支持移动端访问
- 支持常见音频格式
- 支持主流图片格式

## 4. 技术约束

### 4.1 开发框架
- 后端：Python
- 数据库：PostgreSQL
- 消息队列：WebSocket

### 4.2 部署要求
- 容器化部署
- 支持水平扩展
- 提供监控接口
- 日志集中管理