# 架构需求

## 系统架构
### 一、Http 通信模块（http module）
  - http server 管理
  - api 接口
  - swagger api 文档
  - 身份认证拦截

### 二、通信管理模块（Websocket Module）
  - WebSocket 连接管理
  - 消息的publish和subscribe
  - 通信连接状态管理

### 三、文件处理模块（File Module）
* 核心职责：
  - 处理语音文件上传
  - 处理图片文件上传
  - 文件临时存储管理
  - 文件基础信息验证

### 四、AI 识别模块（AI Module）
* 核心职责：
  - 语音转文字能力
  - 图片文字提取能力
  - 文本意图识别能力
  - 结构化信息提取能力
  - 智能 SQL 生成能力

### 四、对话管理模块（Chat Module）
* 核心职责：
  - 对话生命周期维护
  - 消息收发和存储
  - 历史对话管理和查询
  - 对话删除

### 五、场景管理模块（Scenario Module）
* 核心职责：
  - 调用 AI 模块进行订单信息识别
  - 订单信息确认流程处理
  - 订单创建和管理

### 六、订单处理模块（Order Module）
* 核心职责：
  - 调用 AI 模块进行订单信息识别
  - 订单信息确认流程处理
  - 订单创建和管理

### 七、报表处理模块（Report Module）
* 核心职责：
  - 调用 AI 模块生成查询 SQL
  - 报表数据查询执行
  - 报表收藏管理
  - 收藏报表快速查看

### 九、配置管理模块（Config Module）
* 核心职责：
  - YAML 配置文件加载与解析
  - 环境变量配置加载
  - 配置优先级管理
* 配置加载规则：
  - 环境变量配置覆盖YAML配置
  - 环境变量命名规则：
    ```
    # YAML配置示例：
    database:
      host: localhost
      port: 5432
      
    # 对应的环境变量：
    DATABASE_HOST=xxx
    DATABASE_PORT=xxx
    ```

### 十、日志管理模块（Log Module）
* 核心职责：
  - 日志分级管理（DEBUG/INFO/WARN/ERROR）
  - 日志格式化输出
  - 日志文件管理
* 日志规范：
  - 统一的日志格式：
    ```
    [时间戳] [日志级别] [模块名] 日志内容
    ```
  - 日志文件切割与归档

## 技术架构

* 系统使用 Python 语言实现。

* 各个不同模块以代码内嵌模块的形式实现，实现模块间解耦。

* 通过 makefile 等方式将系统编译为 Cpython 可执行文件以保护代码。

* 最终文件打包成二进制镜像，以 Docker 形式部署。

* 使用 postgres 数据库。

* 文件上传使用阿里云的 OSS，身份认证作为中间件。

* 对所有 API 在请求层进行拦截，打印所有请求的输入和输出。

* 系统配置文件既支持 yaml 文件，也支持从环境变量获取，环境变量默认覆盖 yaml 配置文件内容。
